<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Curver</title>
    <link rel="stylesheet" type="text/css" href="static/reset.css">
    <link rel="stylesheet" type="text/css" href="static/main.css">
    <script type="module" src="static/curver.js"></script>
    <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
    <link href="static/font/material-icons.woff2" type="font/ttf">
    
    <style>
        #plotter {
            width: 100%;
            height: 30vh;
        }

        #editor {
            width: 100%;
            height: 40vh;
        }
    </style>
</head>

<body>
    <nav>
        <ul>
            <li><a href="#plotter">plotter</a></li>
            <li><a href="#editor">editor</a></li>
            <li><a href="#settings">settings</a></li>
        </ul>
    </nav>

    <section>
        <h1>Plotter</h1>
        <being-plotter id="plotter"></being-plotter>

        <h1>Spline Editor</h1>
        <being-editor id="editor"></being-editor>

        <h1 id="settings">Settings</h1>
    </section>
</body>

<script type="module">
    import { ready } from "/static/js/utils.js";
    import { bpoly_to_bezier } from "/static/js/bezier.js";
    import { BBox, fit_bbox } from "/static/js/bbox.js";
    import { receive_from_websocket } from "/static/js/web-socket.js";


    ready(function () {
        const plotter = document.getElementById("plotter");
        const editor = document.getElementById("editor");
        const host = window.location.host;
        const streamUrl = 'ws://' + host + '/stream';

        receive_from_websocket(streamUrl, {
            "output-values": [
                msg => plotter.new_data(msg),
                msg => editor.new_data(msg),
            ],
        });


        let spline = {
            "type": "BPoly",
            "extrapolate": true,
            "axis": 0,
            "knots": [0.0, 1.0, 3.0, 6.0],
            "coefficients": [
                [0.0, 1.0, 0.0],
                [0.5888888888888889, 1.2148148148148148, -0.9666666666666666],
                [0.8925925925925928, 0.6444444444444444, -2.1],
                [1.0, 0.0, -0.9999999999999996]
            ]
        };

        editor.load_spline(spline);
    });
</script>

</html>